# txt-to-json using Dataweave functions

Creating a POC that showcases how a TEXT output can be formatted and transformed into JSON.

Let's assume a platform in your organization generates .txt files that contain multiple lines of data separated by spaces and you need to transform the output into JSON.
The lines of data within the .txt file follow a pattern, with each line being generated between certain spaces (e.g. from 0 to 150), and each attribute is also situated between certain spaces (e.g. from 15 to 36). 

The example below takes a generated payload and determines the spacing and the positioning for each attribute, also mapping it to JSON. 

<img width="957" alt="payload" src="https://github.com/Mikkeyson/txt-to-json/assets/169890397/56350b56-7683-4b79-948d-90cd26a07ee3">
&nbsp;

The payload above contains 25 lines of data, with each line containing 9 attributes that will be mapped to JSON.


## The Implementation 

### File Connector

The file will be read from a local folder using the Read File connector from MuleSoft. 
It is to be noted that the output of the file is set to **text/plain**. 

<img width="750" alt="implementation" src="https://github.com/Mikkeyson/txt-to-json/assets/169890397/311a497c-a87a-4569-b486-5ed12ca697ae">

&nbsp;

### Line Format

The next step is to create a set of functions that will work with the payload and turn it into JSON. 

First, we need to know the exact position of each attribute within each line of the data. 

The function below shows how a line can be formatted and transformed into JSON.
&nbsp;

<img width="750" alt="linedefinition" src="https://github.com/Mikkeyson/txt-to-json/assets/169890397/ff8f3578-2a2e-46db-9dc1-6340c1d33792">
&nbsp;

### Separating the lines

Secondly, we'll create a function that splits the lines into JSON objects by the spaces found at the end of each line. 

<img width="750" alt="payloadtransform" src="https://github.com/Mikkeyson/txt-to-json/assets/169890397/67ccbde9-5e95-43a5-8181-fcb3dae78a80">
&nbsp;

The function will then be called within the Transform Message component, refering the payload as follows: **txtToJson(payload)**.

## The output

<img width="550" alt="output" src="https://github.com/Mikkeyson/txt-to-json/assets/169890397/98886192-3967-40c7-9b5e-6e8dd370e23d">
&nbsp;


As it can be seen in the screenshot above, the output generated by the function is an array of objects in a JSON format. 

## Conclusion

The mechanism is simple - it's important to understand the spacing of the payload and the attributes within each line. 

Then, customize the function as per your own needs, ensuring that each attribute is captured correctly. 

&nbsp;
